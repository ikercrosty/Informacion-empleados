{% extends "layout.html" %}
{% block title %}Datos del Cónyuge{% endblock %}

{% block content %}
  <div class="jumbotron-welcome rounded-3 mb-3">
    <div class="d-flex flex-column flex-md-row align-items-center gap-3">
      <div class="flex-grow-1">
        <h1 class="h2 mb-1" style="letter-spacing: .2px; font-weight:700; color:#0b486b;">
          Datos del Cónyuge
        </h1>
        <p class="text-muted mb-2" style="font-size:01.20rem;">
          Información del cónyuge
        <br>
<br>
<br>
        </p>
        <p class="text-muted mb-1" style="font-size:0.65rem;">
        'Presionar "Agrega" para poder agregar un nuevo empleado.'
        </p>
        <p class="text-muted mb-1" style="font-size:0.65rem;">
        'Hacer doble click en una fila para poder "Editar".'
        </p>
        <p class="text-muted mb-1" style="font-size:0.65rem;">
        'Siempre presionar el botón guardar para conservar los cambios.''
        </p>

        <div class="d-flex flex-wrap gap-2 align-items-center mt-2">
          <div class="d-flex gap-2">
          </div>
        </div>
      </div>

      <div class="d-none d-md-flex align-items-center" style="min-width:220px; justify-content:flex-end;">
        <div style="text-align:right;">
          <div style="font-size:.82rem; color:#6b7280;">Empresa</div>
          <div style="font-weight:700; color:#0b486b;">EMPAQUES Y TEXTURAS DE GUATEMALA, S.A.</div>
        </div>
      </div>
    </div>
  </div>
<div class="mb-3">
  <button id="btnAgregar" type="button" class="btn btn-success btn-sm">Agregar</button>
  <button id="btnEditar" type="button" class="btn btn-primary btn-sm" disabled>Editar</button>
  <button id="btnGuardar" type="button" class="btn btn-success btn-sm">Guardar</button>
  <button id="btnCancelar" type="button" class="btn btn-secondary btn-sm">Cancelar</button>
</div>

<div class="table-responsive">
  <table id="tablaConyugue" class="table table-bordered table-striped table-hover table-sm" data-endpoint="/guardar_conyugue">
    <thead class="thead-dark">
      <tr>
        <th>DPI</th><th>Nombre</th><th>Apellidos</th>
        <th>Nombres del cónyuge</th><th>Apellidos del cónyuge</th>
        <th>Dirección del cónyuge</th><th>Teléfono del cónyuge</th><th>Correo del cónyuge</th>
      </tr>
    </thead>
    <tbody>
      {% for e in empleados %}
      <tr>
        <td>{{ e['Numero de DPI']|default('') }}</td>
        <td>{{ e.get('Nombre')|default('') }}</td>
        <td>{{ e.get('Apellidos')|default('') }}</td>
        <td>{{ e.get('Nombres del conyugue')|default('') }}</td>
        <td>{{ e.get('Apellidos del conyugue')|default('') }}</td>
        <td>{{ e.get('Direccion del conyugue')|default('') }}</td>
        <td>{{ e.get('Numero de telefono del conyugue')|default('') }}</td>
        <td>{{ e.get('Correo electronico del conyugue')|default('') }}</td>
      </tr>
      {% endfor %}
    </tbody>
  </table>
</div>

<script>
(function waitRegister(){
  const meta = {
    id: 'tablaConyugue',
    cols: 8,
    endpoint: '/guardar_conyugue',
    campos: [
      "Numero de DPI","Nombre","Apellidos",
      "Nombres del conyugue","Apellidos del conyugue",
      "Direccion del conyugue","Numero de telefono del conyugue","Correo electronico del conyugue"
    ],
    bloqueadas: [0,1,2]
  };
  function tryRegister(n=20){
    if (window.registrarTabla) {
      window.registrarTabla(meta.id, meta.cols, meta.endpoint, meta.campos, meta.bloqueadas);
      // force button defaults
      document.getElementById('btnAgregar').disabled = false;
      document.getElementById('btnEditar').disabled  = true;
      document.getElementById('btnGuardar').disabled = false;
      document.getElementById('btnCancelar').disabled= false;
      return;
    }
    if (n>0) setTimeout(()=>tryRegister(n-1),100);
    else console.error('registrarTabla no disponible para tablaConyugue');
  }
  if (document.readyState==='loading') document.addEventListener('DOMContentLoaded', ()=>tryRegister(20));
  else tryRegister(20);
})();
</script>
{% endblock %}

